CREATE OR REPLACE VIEW NETSUITE_GL 
(
	TRANSACTION_ID								COMMENT 'TRANSACTION ID'
	,TRANSACTION_TYPE							COMMENT 'TRANSACTION TYPE'
	,DOCUMENT_NUMBER							COMMENT 'DOCUMENT NUMBER OF TRANSACTION'
	,TRANDATE									COMMENT 'DATE OF TRANSACTION'
	,STATUS										COMMENT 'TRANSACTION STATUS'
	,ITEM_NBR_MATERIAL_ID						COMMENT 'ITEM NUMBER'
	,ITEM_NAME									COMMENT 'NETSUITE ITEM DISPLAY NAME'
	,ITEM_DESCRIPTION							COMMENT 'NETSUITE ITEM DISPLAY DESCRIPTION'
	,ITEM_TYPE									COMMENT 'TRANSACTION LINE ITEM NETSUITE ITEM INVENTORY TYPE'
	,ITEM_MATERIAL_GROUP						COMMENT 'CORRESPONDS TO PRODUCT DISTINCTIONS OF DIGITAL PRODUCTS'
	,ITEM_PRODUCT_CLASS_1						COMMENT 'TOP LEVEL CLASS OF THE TRANSACTION LINE ITEM (PRODUCT VERTICAL)'
	,ITEM_PRODUCT_CLASS_2						COMMENT 'MIDDLE LEVEL CLASS OF THE TRANSACTION LINE ITEM (PRODUCT FAMILY)'
	,ITEM_PRODUCT_CLASS_3						COMMENT 'BOTTOM LEVEL CLASS OF THE TRANSACTION LINE ITEM (PRODUCT SUB-FAMILY)'
	,AMOUNT										COMMENT 'TRANSACTION LINE AMOUNT'
	,LINE_MEMO									COMMENT 'TRANSACTION LINE MEMO'
	,PAYMENT_METHOD_ID							COMMENT 'PAYMENT METHOD ID'
	,PAYMENT_METHOD_NAME						COMMENT 'PAYMENT METHOD DESCRIPTION'
	,ACCOUNTING_PERIOD_NAME						COMMENT 'POSTED ACCOUNTING PERIOD NAME'
	,ACCOUNTING_PERIOD_YEAR						COMMENT 'YEAR OF POSTED ACCOUNTING PERIOD'
	,ACCOUNTING_PERIOD							COMMENT 'POSTED ACCOUNTING PERIOD'
	,ACCOUNTING_PERIOD_START_DATE				COMMENT 'STARTING DATE OF ACCOUNTING PERIOD'
	,ACCOUNTING_PERIOD_END_DATE					COMMENT 'ENDING DATE OF ACCOUNTING PERIOD'
	,ACCOUNTNUMBER								COMMENT 'TRANSACTION POSTED ACCOUNT NUMBER'
	,ACCOUNT_NAME								COMMENT 'TRANSACTION POSTED ACCOUNT NAME'
	,ACCOUNT_TYPE								COMMENT 'TRANSACTION POSTED ACCOUNT TYPE'
	,PARENT_ACCOUNTNUMBER						COMMENT 'TRANSACTION POSTED PARENT ACCOUNT NUMBER'
	,PARENT_ACCOUNT_NAME						COMMENT 'TRANSACTION POSTED PARENT ACCOUNT NAME'						
	,PARENT_ACCOUNT_TYPE						COMMENT 'TRANSACTION POSTED PARENT ACCOUNT TYPE'
	,DEPARTMENT_NAME							COMMENT 'TRANSACTION POSTED DEPARTMENT NAME'
	,COST_CENTER								COMMENT 'TRANSACTION POSTED COST CENTER'
	,PARENT_DEPARTMENT_NAME						COMMENT 'TRANSACTION POSTED PARENT DEPARTMENT NAME'
)
COMMENT = 'LAITH BARAKAT | THIS VIEW COMPILES ALL TRANSACTIONS AS THEY ARE RELEVANT TO THE GENERAL LEDGER OF NETSUITE.'

AS

SELECT 
	 t.TRANSACTION_ID 
	,t.TRANSACTION_TYPE
	,t.TRANID																				AS DOCUMENT_NUMBER
	,t.TRANDATE
	,t.STATUS
	,i.FULL_NAME                                                                            AS ITEM_NBR_MATERIAL_ID
    ,COALESCE(i.DISPLAYNAME,i.FULL_NAME)                                                    AS ITEM_NAME
    ,COALESCE(i.SALESDESCRIPTION,i.FULL_NAME)                                               AS ITEM_DESCRIPTION
    ,i.TYPE_NAME                                                                            AS ITEM_TYPE
    ,COALESCE(mi.LIST_ITEM_NAME,'- NONE -')                                                 AS ITEM_MATERIAL_GROUP
	,COALESCE(TRIM(cl1.Name,' -')||CASE WHEN cl1.ISINACTIVE = 'Yes' THEN ' *INACTIVE*' ELSE '' END,'- NONE -') AS ITEM_PRODUCT_CLASS_1
    ,COALESCE(TRIM(cl2.Name,' -')||CASE WHEN cl2.ISINACTIVE = 'Yes' THEN ' *INACTIVE*' ELSE '' END,'- NONE -') AS ITEM_PRODUCT_CLASS_2
    ,COALESCE(TRIM(cl3.Name,' -')||CASE WHEN cl3.ISINACTIVE = 'Yes' THEN ' *INACTIVE*' ELSE '' END,'- NONE -') AS ITEM_PRODUCT_CLASS_3
	,-1 * tl.AMOUNT 						AS AMOUNT
    ,tl.LINE_MEMO
    ,tl.PAYMENT_METHOD_ID                   AS PAYMENT_METHOD_ID
    ,pm.NAME                                AS PAYMENT_METHOD_NAME
	,ap.NAME 								AS ACCOUNTING_PERIOD_NAME
	,RIGHT(ap.NAME, 4)						AS ACCOUNTING_PERIOD_YEAR
	,LEFT(ap.NAME, 3) 						AS ACCOUNTING_PERIOD
    ,ap.STARTING                            AS ACCOUNTING_PERIOD_START_DATE
    ,ap.ENDING                              AS ACCOUNTING_PERIOD_END_DATE
	,a.ACCOUNTNUMBER
	,a.FULL_NAME							AS ACCOUNT_NAME
	,a.TYPE_NAME							AS ACCOUNT_TYPE
	,pa.ACCOUNTNUMBER						AS PARENT_ACCOUNTNUMBER
	,pa.FULL_NAME							AS PARENT_ACCOUNT_NAME
	,pa.TYPE_NAME							AS PARENT_ACCOUNT_TYPE
	,d.FULL_NAME							AS DEPARTMENT_NAME
    ,d.DEPARTMENT_EXTID                     AS COST_CENTER
	,pd.FULL_NAME							AS PARENT_DEPARTMENT_NAME
	
FROM VW_TRANSACTIONS               	   AS  t
  LEFT JOIN VW_TRANSACTION_LINES          AS  tl 	ON t.TRANSACTION_ID              = tl.TRANSACTION_ID          
  LEFT JOIN VW_ACCOUNTING_PERIODS         AS  ap 	ON t.ACCOUNTING_PERIOD_ID        = ap.ACCOUNTING_PERIOD_ID          
  LEFT JOIN VW_ACCOUNTS          		   AS  a 	ON tl.ACCOUNT_ID              	 = a.ACCOUNT_ID
  LEFT JOIN VW_ACCOUNTS          		   AS  pa 	ON a.PARENT_ID              	 = pa.ACCOUNT_ID
  LEFT JOIN VW_DEPARTMENTS          	   AS  d 	ON tl.DEPARTMENT_ID              = d.DEPARTMENT_ID
  LEFT JOIN VW_DEPARTMENTS          	   AS  pd 	ON d.PARENT_ID              	 = pd.DEPARTMENT_ID
  LEFT JOIN VW_ITEMS                      AS  i 	ON tl.ITEM_ID                    = i.ITEM_ID
  LEFT JOIN VW_RS_MATERIAL_GROUP          AS  mi 	ON i.material_group_id           = mi.list_id
  LEFT JOIN VW_CLASSES                    AS cl3 	ON COALESCE(i.CLASS_ID,tl.CLASS_ID)= cl3.CLASS_ID           
  LEFT JOIN VW_CLASSES                    AS cl2 	ON cl3.PARENT_ID                   = cl2.CLASS_ID          
  LEFT JOIN VW_CLASSES                    AS cl1 	ON cl2.Parent_ID                   = cl1.CLASS_ID
  LEFT JOIN VW_PAYMENT_METHODS		       AS pm    ON pm.PAYMENT_METHOD_ID            = tl.PAYMENT_METHOD_ID;